{% if tickets %}
<div class="dashboard-block">
    {% if title %}
    <h3>{{ title }}</h3>
    {% endif %}
    <table class="ticket-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Subject</th>
            <th>Submitted By</th>
            <th>Assigned To</th>
            <th>Status</th>
            <th>Created</th>
            {% if show_comments %}
            <th>Last Comment</th>
            {% endif %}
        </tr>
        </thead>
        <tbody>
        {% for ticket in tickets %}
        <tr onclick="window.location.href='{% url 'ticket_detail' ticket.pk %}'">
            <td>#{{ ticket.pk }}</td>
            <td>{{ ticket.title }}</td>
            <td>{{ ticket.created_by.get_full_name|default:ticket.created_by.username }}</td>
            <td>{{ ticket.assigned_to.get_full_name|default:"Unassigned" }}</td>
            <td>{{ ticket.get_status_display }}</td>
            <td>{{ ticket.created_at|date:"M d, Y" }}</td>
            {% if show_comments %}
            <td>
                {% with ticket.comments.last as last_comment %}
                {% if last_comment %}
                {{ last_comment.comment|truncatewords:10 }}
                {% else %}
                <em>No comments</em>
                {% endif %}
                {% endwith %}
            </td>
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
