{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/helpdesk.css' %}">
<link rel="stylesheet" href="{% static 'css/widget.css' %}">
{% endblock %}
{% block title %}Ticket Details{% endblock %}

{% block content %}
<div class="widget">
    <h2>{{ ticket.title }}</h2>
    <p><strong>Status:</strong> {{ ticket.status|capfirst }}</p>
    <p><strong>Assigned to:</strong> {{ ticket.assigned_to.get_full_name|default:"Unassigned" }}</p>
    <p><strong>Submitted by:</strong> {{ ticket.created_by.get_full_name|default:ticket.created_by.username }}</p>
    <p><strong>Branch:</strong> {{ ticket.created_by.userprofile.branch|default:"Not specified" }}</p>
    <p><strong>Description:</strong> {{ ticket.description }}</p>
    <hr>

    {% if update_form %}
    <h3>Update Ticket</h3>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="update_ticket" value="1">
        {{ update_form.non_field_errors }}
        <div class="form-group">
            {{ update_form.status.label_tag }}
            {{ update_form.status }}
            {% if update_form.status.errors %}
            <div class="field-error">{{ update_form.status.errors }}</div>
            {% endif %}
        </div>
        <div class="form-group">
            {{ update_form.assigned_to.label_tag }}
            {{ update_form.assigned_to }}
            {% if update_form.assigned_to.errors %}
            <div class="field-error">{{ update_form.assigned_to.errors }}</div>
            {% endif %}
        </div>
        <button type="submit" class="btn">Update Ticket</button>
    </form>
    <hr>
    {% endif %}

    <h3>Comments</h3>
    <ul>
        {% for comment in comments %}
        <li><strong>{{ comment.author.get_full_name|default:comment.author.username }}</strong>: {{ comment.comment }}
        </li>
        {% endfor %}
    </ul>

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="comment_submit" value="1">
        <div class="form-group">
            {{ form.comment.label_tag }}
            {{ form.comment }}
            {% if form.comment.errors %}
            <div class="field-error">{{ form.comment.errors }}</div>
            {% endif %}
        </div>
        <button type="submit" class="btn">Add Comment</button>
    </form>
</div>
{% endblock %}
